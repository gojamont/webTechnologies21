{% extends "index.html" %}

{% block title %}Your Cart{% endblock %}

{% block main %}
<section class="cartSection">
    <h1>Your Shopping Cart</h1>
    <div id="cartContainer">
        <!-- Cart items will be rendered here by JS -->
    </div>
    <div id="cartTotal" style="margin-top:2em; font-weight:600;"></div>
    <button id="clearCartBtn" style="margin-top:1em;">Clear Cart</button>
</section>
<script>
document.addEventListener("DOMContentLoaded", function () {</script>
    function getCart() {
        const cart = localStorage.getItem("cart");
        return cart ? JSON.parse(cart) : [];
    }

    function saveCart(cart) {
        localStorage.setItem("cart", JSON.stringify(cart));
    }

    function renderCart() {
        const cart = getCart();
        const container = document.getElementById("cartContainer");
        const totalDiv = document.getElementById("cartTotal");
        container.innerHTML = "";
        let total = 0;

        if (cart.length === 0) {
            container.innerHTML = "<p>Your cart is empty.</p>";
            totalDiv.textContent = "";
            return;
        }

        cart.forEach((item, idx) => {
            total += parseFloat(item.price);
            const itemDiv = document.createElement("div");
            itemDiv.className = "cartItem";
            itemDiv.style.display = "flex";
            itemDiv.style.alignItems = "center";
            itemDiv.style.marginBottom = "1em";
            itemDiv.innerHTML = `
                <img src="${item.img}" alt="${item.title}" style="width:60px;height:60px;object-fit:cover;margin-right:1em;">
                <span style="flex:1;">${item.title}</span>
                <span style="margin-right:1em;">$${item.price}</span>
                <button data-idx="${idx}" class="removeCartBtn" style="background:#e74c3c;color:white;border:none;padding:0.5em 1em;border-radius:5px;">Remove</button>
            `;
            container.appendChild(itemDiv);
        });

        totalDiv.textContent = "Total: $" + total.toFixed(2);

        // Attach remove handlers
        document.querySelectorAll(".removeCartBtn").forEach(btn => {
            btn.addEventListener("click", function () {
                const idx = parseInt(btn.getAttribute("data-idx"));
                const cart = getCart();
                cart.splice(idx, 1);
                saveCart(cart);
                renderCart();
            });
        });
    }

    document.getElementById("clearCartBtn").addEventListener("click", function () {
        localStorage.removeItem("cart");
        renderCart();
    });

    renderCart();
});
</script>
<style>
.cart</style>Section {
    max-width: 600px;
    margin: 2em auto;
    padding: 2em;
    background: #f9f9f9;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.cartItem {
    border-bottom: 1px solid #ddd;
    padding-bottom: 1em;
}
</style>
{% endblock %}
