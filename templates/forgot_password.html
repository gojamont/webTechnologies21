{% extends "index.html" %}

{% block title %}Forgot Password{% endblock %}

{% load static %}
{% block styles %}<link rel="stylesheet" href="{% static 'css/loginPageStyles.css' %}">{% endblock %}

{% block main %}
<form class="loginForm" onsubmit="forgotPassword(event)">
    <h1>Forgot Password</h1>

    <div class="error-message" style="font-size:0.8rem;color:red;display:none;"></div>
    <div class="success-message" style="font-size:0.8rem;color:green;display:none;"></div>

    <input type="email" placeholder="Enter your email" name="email" autocomplete="off">

    <div class="formButtonField">
        <button class="loginBtn" type="submit">Send Reset Link</button>
    </div>
</form>

<script>
async function forgotPassword(event) {
    event.preventDefault();
    const form = event.target;
    const email = form.email.value;

    const errorDiv = form.querySelector(".error-message");
    const successDiv = form.querySelector(".success-message");
    errorDiv.style.display = "none";
    successDiv.style.display = "none";

    try {
        const response = await fetch("/forgot-password/", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                "X-CSRFToken": "{{ csrf_token }}",
            },
            body: new URLSearchParams({ email }),
        });
        const data = await response.json();
        if (data.success) {
            successDiv.innerText = data.message;
            successDiv.style.display = "block";
        } else {
            errorDiv.innerText = data.message;
            errorDiv.style.display = "block";
        }
    } catch (err) {
        errorDiv.innerText = "An error occurred. Try again.";
        errorDiv.style.display = "block";
    }
}
</script>
{% endblock %}
